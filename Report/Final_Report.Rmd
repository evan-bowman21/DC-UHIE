---
title: "Correlates and Policy Remedies of DC's Urban Heat Island Effect"
author: "Evan Bowman"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  pdf_document: default
  html_document: default
  word_document: default
bibliography: Memo.bib
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
\newpage
```{r, include=FALSE}
# Initial package and data loading not included in the report
library(tidyverse)
library(sf)
library(tidycensus)
library(keyring)
library(broom)
library(leaps)

heat <- read_csv("../data/Heat_Sensitivity_Exposure_Index.csv", show_col_types = F)

dc_median <- get_acs(state = "DC", county = "District of Columbia",
                     geography = "tract",
                     variables = "B19013_001",
                     geometry = TRUE,
                     key = key_get("API_KEY_CENSUS"))

heat_full <- left_join(heat, dc_median, by = c("NAME" = "NAME"))

heat_full <- heat_full %>%
  mutate(majority_minority = case_when(P_POC >= 50 ~ "TRUE",
                                       TRUE ~ "FALSE"))
```

# Introduction

A major discussion in today's politics is the consequences of climate change and what is to come if no meaningful attempt at mitigating atmospheric greenhouse gasses occurs. These consequences, on a meta level, range from higher mean temperatures, sea level rise, and changes in the ability to grow sustainable food. These potential consequences poses large public health risks such as increases in heat related deaths and illness. This is cause for concern as about 25 percent of natural hazard mortality in the country is caused by heat exposure [@benz2021widespread]. Furthermore, heat-related mortality in the USA causes roughly 1,500 more deaths annually than other severe weather events, as well as other outcomes such as heat strokes, dehydration, loss of labor productivity, and decreased learning [@hsu2021disproportionate]. The potential increase in heat related health incidents requires a substantial need for policy to combat increases in mean temperatures. 

Little discussion looks at the discrepancies these effects might have on urban populations. On the topic of increased global temperature averages, there is a need to look at the intersectionality of an already occurring phenomenon: urban heat island effects. This concept revolves around the key fact that urbanized city centers already create higher mean temperatures compared to their rural counterparts. Not only are these urban centers more likely to have higher mean temperatures than rural areas, there are clear sociodemographic discrepancies between populations within these cities. Few studies have been published analyzing these demographic discrepancies. However, in one report, research has found that roughly 77 percent of counties studied show that there are large differences in change of daytime temperature between census tracts with the highest and lowest Black population proportions. Furthermore, 81 percent of counties studied with lower difference in daytime temperature are majority non-Hispanic White. [@benz2021widespread]. There is also empirical evidence that shows discrepancies in urban heat island effects targeting communities that are more impoverished. For example, a 2020 study found that there is a negative correlation of .88 between cities' urban heat island effects and income [@chakraborty2020spatially]. This is further cause for concern when looking at potential correlations between poverty and race in city census tracts. 

These findings are consistent with research that shows majority minority populations in urban centers have less tree cover and larger proportions of impervious surfaces than majority non-Hispanic White populations. This shows a clear need for social policy that protects majority minority census tracts from being disproportionately affected by increased heat island effects. Research regarding the effects of urban heat island effects must be on a local level to adequately identify meaningful social demographic trends for areas within urban centers. These could be specific neighborhoods, districts, census tracts, etc. In the context of racial inequities in Washington DC, most research is done at the ward level. For this study, census tracts are chosen as sample observations to be able to identify which specific areas of DC's eight wards are most at risk of the urban heat island effect, and the demographic patterns that coincide with these risks.

# Research Questions

**What are reoccurring sociodemographic trends that are associated with higher heat sensitivity indexes?** Who are the communities at a larger risk of heat-induced health events due to higher heat sensitivity index (HSI)? HSI is a metric that describes an individuals ability to adapt, cope, or recover from extreme heat and is explained by specific demographic and health variables of DC's census tracts. Identifying socioeconomic and health trends can assist policy makers in identifying the communities who would best benefit from policy implementation. 

**What are the environmental metrics that are correlated with the census tracts with the highest HSI?** What environmental characteristics of certain census tracts create larger heat exposure indexes (HEI)? In the data, HEI is a metric that takes a census tract's mean ambient air temperature as the exposure variable (50 percent) and two physical variables (impervious surfaces: 25 percent, lack of tree cover: 25 percent) that describe a tract's heat retention. Understanding the environmental factors would help in identifying policy approaches that would mitigate the consequences of the urban heat island effect by assisting at risk census tracts with solutions to heat retention. 

**Do these findings highlight environmental justice issues that exist within Washington DC?** Do the findings of this study concur with previous research regarding race inequities for heat exposure and sensitivity in urban centers? The ultimate goal in answering these two research questions is to find the intersectionality of environmental that exacerbate the urban heat island effect and the populations of urban centers most at risk. 

# Heat Sensitivity Index and Socioeconomic Patterns

```{r, echo=FALSE}
heat_full %>%
  filter(HSI > 0) %>%
ggplot(aes(fill = HSI)) +
    geom_sf(aes(geometry = geometry), color = NA) +
    scale_fill_viridis_c() +
  labs(caption = "Fig. 1")
```

As seen from the Figure 1, the census tracts with the highest HSI levels fall within areas along the Anacostia River, also found within Wards 7 and 8. These census tracts are a vast contrast when compared to census tracts with low HSI levels found in the Northwest portion of the city. Analysis conducted in this section will look to define what specific patterns exist within tracts with high HSI levels. 

## Visualizing Patterns

Areas along the Anacostia River are typically known for being predominately majority minority as well as lower income compared to census tracts in the Northwest. This further contributes to the hypothesis of racial inequity in DC's Urban Heat Island Effect as the intersectionality of poverty and race exacerbates indibiduals ability to cope with extreme heat (Fig. 2).  


```{r, echo=FALSE}
poc_map <- heat_full %>%
  filter(HSI > 0) %>%
ggplot(aes(fill = P_POC)) +
    geom_sf(aes(geometry = geometry), color = NA) +
    scale_fill_viridis_c() +
    ggtitle("% People of Color of Census Tracts") +
  theme_bw()

pov_map <- heat_full %>%
  filter(HSI > 0) %>%
ggplot(aes(fill = P_POVERTY)) +
    geom_sf(aes(geometry = geometry), color = NA) +
    scale_fill_viridis_c() +
    ggtitle("% Poverty of Census Tracts") +
  theme_bw()

gridExtra::grid.arrange(poc_map, pov_map, ncol = 2, right = "Fig. 2")
```

Other interesting patterns found within the data are health trends and specific discrepancies between predominately non-Hispanic White census tracts and predominately Black census tracts. For all four health variables found within the data set, asthma, obesity, coronary heart disease (CHD), and disability, majority minority census tracts exhibit higher prevalence than predominately White tracts (Fig. 3). This highlights the increased risk of health related events that are exacerbated by a higher sensitivity to heat and the inability to cope or adapt to it.     

```{r, echo=FALSE}
asthma <- heat_full %>%
  filter(HSI > 0) %>%
  ggplot(aes(majority_minority, ASTHMA)) +
  geom_boxplot() +
  ggtitle("Asthma") +
  xlab("Majority Minority") +
  ylab("Asthma") + 
  theme_bw()

obesity <- heat_full %>%
  filter(HSI > 0) %>%
  ggplot(aes(majority_minority, OBESITY)) +
  geom_boxplot() +
  ggtitle("Obesity") +
  xlab("Majority Minority") +
  ylab("Obesity") +
  theme_bw()

chd <- heat_full %>%
  filter(HSI > 0) %>%
  ggplot(aes(majority_minority, CHD)) +
  geom_boxplot() +
  ggtitle("CHD") +
  xlab("Majority Minority") +
  ylab("CHD") +
  theme_bw()

disability <- heat_full %>%
  filter(HSI > 0) %>%
  ggplot(aes(majority_minority, P_DISABILITY)) +
  geom_boxplot() +
  ggtitle("Disability") +
  xlab("Majority Minority") +
  ylab("Disability") +
  theme_bw()

gridExtra::grid.arrange(asthma, obesity, chd, disability, ncol = 2, right = "Fig. 3")
```

With preliminary patterns relating to a census tract's Heat Sensitivity Index established, this paper will shift to creating a preliminary model that best exemplifies which variables contribute most to HSI metrics for a given census tract.  

## Regression Definition

### Preliminary Regression Identification

To best understand to what magnitude socioeconomic factors affect HSI levels, preliminary regression models will be created to identify variables of statistical significance. To achieve the best possible model, best subsets regression, forward stepwise, and backward stepwise will be conducted and the best model will be taken following the analysis of adjusted r-squared, Mallows CP, and BIC.

The first model will be utilizing the best subsets regression strategy through the leaps package. The model was fitted and the best eight models are shown below. Summary statistics of each model will be analyzed to figure which model will be chosen (Table 1).
```{r, include=FALSE}
hsi_model <- heat_full %>%
  filter(HSI > 0) %>%
  select(P_POC:HSI)
hsi_model$P_LIMENG = as.numeric(hsi_model$P_LIMENG)
regFull <- regsubsets(HSI~ ., hsi_model)
model_sum <- summary(regFull)


# Regression Summary Plots
par(mfrow=c(1,1))
plot(regFull, scale = "r2")
plot(regFull, scale = "adjr2")
plot(regFull, scale = "Cp")
plot(regFull, scale = "bic")

adjr2_bs <- summary(regFull)$adjr2
cp_bs <- summary(regFull)$cp  
bic_bs <- summary(regFull)$bic  


# Identifying best values
which.max(summary(regFull)$adjr2)
which.min(summary(regFull)$cp) 
which.min(summary(regFull)$bic) 
```

```{r, echo=FALSE}
bs_table <- data.frame(model = c(1:8),
          adjr2 = adjr2_bs, 
           cp = cp_bs,
           bic = bic_bs)
knitr::kable(bs_table, caption = "Best Subsets Regression")
```

Model 5 returned the highest adjusted r-squared value, lowest Mallow's Cp value, and second lowest BIC value. This shows that the model captures the highest variation in HSI, the best predicting power for all possible models, and the second lowest bias for all possible models using the Best Subsets method. Forward and Backwards Stepwise regression returned the same results (Table 3). Thus, the model selected will include the variables percent people of color (P_POC), percent elderly (P_ELDERLY), percent poverty (P_POVERTY), percent limited English (P_LIMENG), and asthma (ASTHMA). 


```{r, include=FALSE}
# Stepwise Fitting
regfit.fwd <- regsubsets(HSI ~ ., data = hsi_model, method = "forward")
summary(regfit.fwd)

# Summary Plots
par(mfrow=c(1,1))
plot(regfit.fwd, scale = "r2")
plot(regfit.fwd, scale = "adjr2")
plot(regfit.fwd, scale = "Cp")
plot(regfit.fwd, scale = "bic")

adjr2_fs <- summary(regfit.fwd)$adjr2  
cp_fs <- summary(regfit.fwd)$cp  
bic_fs <- summary(regfit.fwd)$bic  

# Identifying best values
which.max(summary(regfit.fwd)$adjr2)
which.min(summary(regfit.fwd)$cp) 
which.min(summary(regfit.fwd)$bic) 

# Backwards Fitting
regfit.bwd <- regsubsets(HSI ~ ., data = hsi_model, method = "backward")
summary(regfit.bwd)

# Summary Plots
par(mfrow=c(1,1))
plot(regfit.bwd, scale = "r2")
plot(regfit.bwd, scale = "adjr2")
plot(regfit.bwd, scale = "Cp")
plot(regfit.bwd, scale = "bic")

adjr2_bstep <- summary(regfit.bwd)$adjr2  
cp_bstep <- summary(regfit.bwd)$cp  
bic_bstep <- summary(regfit.bwd)$bic  

# Identifying best values
which.max(summary(regfit.bwd)$adjr2)
which.min(summary(regfit.bwd)$cp) 
which.min(summary(regfit.bwd)$bic) 
```

```{r, echo=FALSE}
fs_table <- data.frame(model = c(1:8),
          adjr2 = adjr2_fs, 
           cp = cp_fs,
           bic = bic_fs)

bstep_table <- data.frame(model = c(1:8),
          adjr2 = adjr2_bstep, 
           cp = cp_bstep,
           bic = bic_bstep)

knitr::kable(list(fs_table, bstep_table), caption = "Forward and Backward Stepwise")
```

The fitted regression model is shown below

```{r, include=FALSE}
library(tidymodels)
library(parsnip)
```

```{r, echo=FALSE}
set.seed(2200)
data_split <- hsi_model %>%
  initial_split(prop = 4/5)

hsi_train <- training(data_split)
hsi_test <- testing(data_split)

lm_fit <- linear_reg() %>%
  fit(HSI ~ P_POC + P_ELDERLY + P_POVERTY + P_LIMENG + ASTHMA, data = hsi_train)
tidy(lm_fit)


out_preds <- bind_cols(hsi_test %>% select(HSI),
                       predict(lm_fit, new_data = hsi_test)) %>%
                       rename(lm = .pred)
```


## Shrinkage Regression

While best subsets regression identified the best model as including five variables, there is clear covariation that affects the magnitude of the coefficients (Appendix A). As a result, a LASSO regression model will be fitted and compared to the original regression model. LASSO takes into account the covariation of the predictors, and adjusts the coefficients accordingly. 
```{r, echo=FALSE}
# LASSO 
set.seed(2200)

lasso_fit <- linear_reg(mixture = 1) %>%
  fit(HSI ~ P_POC + P_ELDERLY + P_POVERTY + P_LIMENG + ASTHMA, data = hsi_train)
tidy(lasso_fit)

full_preds <- bind_cols(out_preds,
                        predict(lasso_fit, new_data = hsi_test)) %>%
  rename(lasso = .pred)
```

# Environmental Factors of Heat Exposure Indexes

It is important to understand not only socioeconomic factors that contribute to a census tract's HSI statistic, but also the environmental factors that contribute to their Heat Exposure Index. However, unlike HSI, HEI is defined in for each census tract as 50 percent mean air temperature, 25 percent lack of tree canopy, and 25 percent impervious surface. As a result, analysis will be centered around patterns of three variables as opposed to any model building to predict HEI values. 

```{r, include = FALSE}
hei <- heat_full %>% 
  select(P_TREECOVER:HEI, geometry)
```

```{r, echo=FALSE}
hei_map <- hei %>%
ggplot(aes(fill = HEI)) +
    geom_sf(aes(geometry = geometry), color = NA) +
    scale_fill_viridis_c() +
    labs(title = "HEI") +
  theme_bw() 

air_map <- hei %>%
ggplot(aes(fill = AIRTEMP_MEAN)) +
    geom_sf(aes(geometry = geometry), color = NA) +
    scale_fill_viridis_c() +
    labs(title = "Mean Air Temp") +
  theme_bw()

imp_map <- hei %>%
ggplot(aes(fill = P_IMPSURF)) +
    geom_sf(aes(geometry = geometry), color = NA) +
    scale_fill_viridis_c() +
    labs(title = "% Impervious Surface") +
  theme_bw()

no_tree_map <- hei %>%
ggplot(aes(fill = P_NOTREE)) +
    geom_sf(aes(geometry = geometry), color = NA) +
    scale_fill_viridis_c() +
    ggtitle("% No Tree") +
  theme_bw()

gridExtra::grid.arrange(hei_map, air_map, imp_map, no_tree_map, ncol = 2, right = "Fig. 7")
```


```{r, echo=FALSE}
tree <- heat_full %>%
  filter(HEI >0) %>%
  ggplot(aes(majority_minority, P_TREECOVER)) +
  geom_boxplot()

no_tree <- heat_full %>%
  filter(HEI >0) %>%
  ggplot(aes(majority_minority, P_NOTREE)) +
  geom_boxplot()

temp <- tree <- heat_full %>%
  filter(HEI >0) %>%
  ggplot(aes(majority_minority, AIRTEMP_MEAN)) +
  geom_boxplot()

imp_surf <- tree <- heat_full %>%
  filter(HEI >0) %>%
  ggplot(aes(majority_minority, P_IMPSURF)) +
  geom_boxplot()

gridExtra::grid.arrange(tree, no_tree, temp, imp_surf, ncol = 2, right = "Fig. 8")
```


\newpage

# Appendix
```{r, echo=FALSE}
cor_table <- hsi_model %>%
  na.omit() %>%
  cor() %>%
  round(digits = 3)

knitr::kable(cor_table, caption = "Correlation table of HSI variables")
```

\newpage
# **References**

